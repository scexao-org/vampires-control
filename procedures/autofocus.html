<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Autofocusing &mdash; VAMPIRES Control</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=fd3f3429" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=01f34227"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Coronagraph Alignment" href="coronagraphs.html" />
    <link rel="prev" title="Troubleshooting" href="../operating/troubleshooting.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            vampires_control
          </a>
              <div class="version">
                0.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#using-pip">Using <code class="docutils literal notranslate"><span class="pre">pip</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#from-source">From Source</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#testing">Testing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../gettingstarted.html#navigating-the-documentation">Navigating the Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../gettingstarted.html#operating-vampires">Operating VAMPIRES</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gettingstarted.html#procedures">Procedures</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gettingstarted.html#observing-with-vampires">Observing with VAMPIRES</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../gettingstarted.html#code-examples">Code Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../gettingstarted.html#python-example">1. Python example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gettingstarted.html#command-line">2. Command line</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../gettingstarted.html#faq">FAQ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API/Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/environment_variables.html">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/api.html">API/Reference</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Operating VAMPIRES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../operating/layout.html">Instrument Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operating/cameras.html">Cameras</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../operating/cameras.html#initialization-and-viewers">Initialization and Viewers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../operating/cameras.html#vcam1-and-vcam2">VCAM1 and VCAM2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../operating/cameras.html#vpupcam">VPUPCAM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../operating/cameras.html#detector-readout-modes">Detector Readout Modes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../operating/cameras.html#photon-transfer-curves">Photon Transfer Curves</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../operating/cameras.html#detector-astrometric-solution">Detector Astrometric Solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operating/cameras.html#camera-crops">Camera Crops</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../operating/cameras.html#standard">Standard</a></li>
<li class="toctree-l3"><a class="reference internal" href="../operating/cameras.html#mbi">MBI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../operating/cameras.html#mbi-reduced">MBI Reduced</a></li>
<li class="toctree-l3"><a class="reference internal" href="../operating/cameras.html#pupil">Pupil</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../operating/cameras.html#exposure-time">Exposure time</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operating/cameras.html#camera-triggering">Camera Triggering</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../operating/cameras.html#aflc-disabled">AFLC Disabled</a></li>
<li class="toctree-l3"><a class="reference internal" href="../operating/cameras.html#aflc-enabled">AFLC Enabled</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../operating/cameras.html#crop-location-and-mbi-hotspots">Crop location and MBI hotspots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operating/cameras.html#miscellaneous">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../operating/viewers.html">Camera Viewers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../operating/viewers.html#vcam1-and-vcam2">VCAM1 and VCAM2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operating/viewers.html#vpupcam">VPUPCAM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operating/viewers.html#others">Others</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operating/viewers.html#faq">FAQ</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../operating/viewers.html#the-crop-is-all-weird">1. The crop is all weird!</a></li>
<li class="toctree-l3"><a class="reference internal" href="../operating/viewers.html#the-cameras-froze">2. The cameras froze!</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../operating/coronagraphs.html">Coronagraphs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../operating/coronagraphs.html#focal-plane-masks">Focal Plane Masks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operating/coronagraphs.html#lyot-stops">Lyot Stops</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../operating/coronagraphs.html#advanced-details">Advanced Details</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../operating/devices.html">Device Control</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../operating/devices.html#interacting-with-devices">Interacting with devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operating/devices.html#filters">Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operating/devices.html#field-stop-focal-plane-mask">Field Stop / Focal Plane Mask</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operating/devices.html#mask-wheel">Mask Wheel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operating/devices.html#differential-wheel">Differential Wheel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operating/devices.html#beamsplitter-wheel">Beamsplitter Wheel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operating/devices.html#mbi-wheel">MBI Wheel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operating/devices.html#focus-stages">Focus Stages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operating/devices.html#aflc-stage">AFLC Stage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operating/devices.html#qwps">QWPs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../operating/data.html">Data Acquisition</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../operating/data.html#data-flowchart">Data Flowchart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operating/data.html#logging-fits-files">Logging FITS files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../operating/data.html#option-1-using-vampires-scripts">Option 1: Using VAMPIRES scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../operating/data.html#option-2-directly-using-fpsctrl">Option 2: Directly using fpsCTRL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../operating/data.html#watching-fits-files">Watching FITS files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../operating/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Procedures</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Autofocusing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#standard-procedure">Standard procedure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#narrowband-filters">Narrowband filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#visible-bench-pickoffs">Visible bench pickoffs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#single-cam-focus-no-beamsplitter">Single-cam focus (no beamsplitter)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pupil-mode">Pupil mode</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="coronagraphs.html">Coronagraph Alignment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="coronagraphs.html#focal-plane-mask-aligment">Focal plane mask aligment</a></li>
<li class="toctree-l2"><a class="reference internal" href="coronagraphs.html#lyot-stop-alignment">Lyot stop alignment</a></li>
<li class="toctree-l2"><a class="reference internal" href="coronagraphs.html#advanced-focusing">(Advanced) Focusing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="coronagraphs.html#autofocusing">Autofocusing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mbi.html">Multiband Imaging</a><ul>
<li class="toctree-l2"><a class="reference internal" href="mbi.html#inserting">Inserting</a></li>
<li class="toctree-l2"><a class="reference internal" href="mbi.html#removing">Removing</a></li>
<li class="toctree-l2"><a class="reference internal" href="mbi.html#mbi-reduced">MBI Reduced</a></li>
<li class="toctree-l2"><a class="reference internal" href="mbi.html#advanced-mbi-hotspotting">(Advanced) MBI Hotspotting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="data.html">Post-observing Data Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="data.html#synchronization-and-consolidation">Synchronization and Consolidation</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html#frame-ids">Frame IDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html#compression">Compression</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html#creating-manifest-and-uploading-to-stars2">Creating Manifest and Uploading to STARS2</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Observing with VAMPIRES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../observing/calibrations.html">Calibration Procedures</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../observing/calibrations.html#nightly-pre-observing-calibrations">Nightly / Pre-observing Calibrations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../observing/calibrations.html#flat-frames">Flat frames</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observing/calibrations.html#pinhole-frames">Pinhole frames</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observing/calibrations.html#dark-frames">Dark frames</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../observing/calibrations.html#post-observing-calibrations">Post-observing Calibrations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../observing/calibrations.html#id1">Dark frames</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../observing/calibrations.html#on-sky-calibrations">On-sky Calibrations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../observing/calibrations.html#sky-frames">Sky Frames</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observing/calibrations.html#photometric-standards">Photometric Standards</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observing/calibrations.html#astrometric-standards">Astrometric Standards</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../observing/polarimetry.html">Polarimetry</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../observing/polarimetry.html#setup-slow-mode">Setup: Slow Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observing/polarimetry.html#setup-fast-mode">Setup: Fast Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observing/polarimetry.html#operating">Operating</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../observing/polarimetry.html#triggering">Triggering</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observing/polarimetry.html#hwp-modulation">HWP Modulation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../observing/polarimetry.html#teardown">Teardown</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">vampires_control</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Autofocusing</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/procedures/autofocus.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="autofocusing">
<h1>Autofocusing<a class="headerlink" href="#autofocusing" title="Link to this heading"></a></h1>
<p>VAMPIRES has two focus stages</p>
<ol class="arabic simple">
<li><p>The linear stage that the objective lens is mounted on</p></li>
<li><p>The linear stage that VCAM1 is mounted on</p></li>
</ol>
<p>In general, you need to use both stages to optimize focus for both cameras. The standard procedure for “dual-cam” focusing is</p>
<ol class="arabic simple">
<li><p>Focus VCAM2 by optimizing the position of the objective lens stage</p></li>
<li><p>Focus VCAM1 by optimizing the position of the camera stage
this order is required because the lens focus stage is the only way to change the focus of VCAM2 given its fixed mount.</p></li>
</ol>
<p>There is an automated utility for dual-cam focusing that will take multiple frames of data, average them together, compute a focusing metric, and performs a simple grid-search to optimize the position. Currently the focusing metric is the Strehl ratio. In our testing searching +-1 mm from a decent starting point is sufficient to find an optimum- we fit a quadratic polynomial to interpolate the best focus position from the scan.</p>
<section id="standard-procedure">
<h2>Standard procedure<a class="headerlink" href="#standard-procedure" title="Link to this heading"></a></h2>
<p>The default setup for VAMPIRES is dual-cam mode which has the configuration names “STANDARD” for the lens stage and “DUAL” for the camera stage</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sonne $ vampires_focus standard
sonne $ vampires_camfocus dual
</pre></div>
</div>
<p>from here run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sonne $ autofocus lens -c 2
</pre></div>
</div>
<p>and then save the outputs if everything looks good</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sonne $ vampires_focus --save 1
</pre></div>
</div>
<p>and now do the same for the converse stage-</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sonne $ autofocus cam -c 1
sonne $ vampires_camfocus --save 1
</pre></div>
</div>
</section>
<section id="narrowband-filters">
<h2>Narrowband filters<a class="headerlink" href="#narrowband-filters" title="Link to this heading"></a></h2>
<p>If using the narrowband filters a small focus shift is introduced, so a separate lens stage config, “SDI”, is used.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sonne $ vampires_diff 2
sonne $ vampires_focus sdi
sonne $ vampires_camfocus dual
</pre></div>
</div>
<p>In theory the differential focus should not change with the introduction of the differential narrowband filters, so only the lens stage needs optimized- the following will only use the VCAM1 image to focus the lens</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sonne $ autofocus lens -c 1
sonne $ vampires_focus --save 2
</pre></div>
</div>
</section>
<section id="visible-bench-pickoffs">
<h2>Visible bench pickoffs<a class="headerlink" href="#visible-bench-pickoffs" title="Link to this heading"></a></h2>
<p>Similar to the narrowband filter case, if any FIRST/VisPL pickoffs are in there is another focus shift that can be optimized by the lens stage only. Currently only one configuration for the VisPL pickoff is set</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sonne $ vampires_focus vpl
sonne $ vampires_camfocus dual
sonne $ autofocus lens -c 1 
sonne $ vampires_focus --save 4
</pre></div>
</div>
</section>
<section id="single-cam-focus-no-beamsplitter">
<h2>Single-cam focus (no beamsplitter)<a class="headerlink" href="#single-cam-focus-no-beamsplitter" title="Link to this heading"></a></h2>
<p>For the case of observations that do not want to use the beamsplitter we move the camera stage to accommadate the large focus shift from the 25 mm thick beamsplitter</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sonne $ vampires_bs open
sonne $ vampires_focus standard
sonne $ vampires_camfocus single
sonne $ autofocus lens -c 1
sonne $ vampires_camfocus --save 2
</pre></div>
</div>
</section>
<section id="pupil-mode">
<h2>Pupil mode<a class="headerlink" href="#pupil-mode" title="Link to this heading"></a></h2>
<p>The image created by the pupil lens is very defocused- it is actually impossible to get a focused image on VCAM2. The setup is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sonne $ vampires_focus pupil
sonne $ vampires_camfocus pupil
</pre></div>
</div>
<p>which puts the lens stage at its minimum (0 mm). There is no automated script for focusing the pupil image, it must be done by hand. Once satisfied, save the position with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sonne $ vampires_focus --save 3
sonne $ vampires_camfocus --save 3
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../operating/troubleshooting.html" class="btn btn-neutral float-left" title="Troubleshooting" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="coronagraphs.html" class="btn btn-neutral float-right" title="Coronagraph Alignment" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, 2023, 2024, Miles Lucas.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>